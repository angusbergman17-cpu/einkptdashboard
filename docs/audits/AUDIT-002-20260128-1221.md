# AUDIT-002: Comprehensive Phase 5 System Audit

**Date:** 2026-01-28 12:21 AEDT  
**Auditor:** Lobby (PTV-TRMNL Dev Partner)  
**Scope:** Full Phase 5 pre-deployment audit  
**Status:** ⚠️ ISSUES FOUND

---

## Executive Summary

This audit verifies device specifications against manufacturer data, compares firmware to simulator behavior, and identifies sanitization requirements for public release.

**Overall Score: 65%** - Critical issues require remediation before Phase 6.

---

## 1. DEVICE SPECIFICATION VERIFICATION

### Source: Wikipedia Amazon Kindle specifications (verified 2026-01-28)

| Device | Wikipedia Spec | Firmware Config | Status |
|--------|---------------|-----------------|--------|
| Kindle Paperwhite 3 | 1072×1448 @ 300 PPI | 1072×1448 @ 300 PPI | ✅ MATCH |
| Kindle Paperwhite 4 | 1072×1448 @ 300 PPI | 1072×1448 @ 300 PPI | ✅ MATCH |
| Kindle Paperwhite 5 | 1236×1648 @ 300 PPI | 1236×1648 @ 300 PPI | ✅ MATCH |
| Kindle 11 (2022) | 1072×1448 @ 300 PPI | 1072×1448 @ 300 PPI | ✅ MATCH |
| Kindle Basic 10 | 600×800 @ 167 PPI | 600×800 @ 167 PPI | ✅ MATCH |
| TRMNL OG | 800×480 (ESP32-C3) | 800×480 | ✅ MATCH |

**Result: 6/6 devices verified ✅**

### Additional Device Details (from Wikipedia)

#### Kindle Paperwhite 3 (7th Gen, June 2015)
- Model: DP75SDI
- Display: 6-inch Carta e-paper, 16-level grayscale
- CPU: Freescale/NXP i.MX6 SoloLite 1 GHz
- RAM: 512 MB
- Storage: 4GB
- Battery: 1,420 mAh
- Firmware config notes: Full refresh every 10 updates, ordered dithering

#### Kindle Paperwhite 4 (10th Gen, November 2018)
- Model: PQ94WIF
- Display: 6-inch Carta 1100, 16-level grayscale, LED frontlit
- CPU: Freescale/NXP i.MX6 SoloLite 1 GHz
- RAM: 512 MB
- Storage: 8/32GB
- Battery: 1,500 mAh
- Waterproof: IPX8
- Firmware config notes: Full refresh every 10 updates, ordered dithering

#### Kindle Paperwhite 5 (11th Gen, October 2021)
- Model: M2L3EK
- Display: 6.8-inch Carta 1200, 16-level grayscale, 17 LEDs
- CPU: MediaTek MT8110 1 GHz
- RAM: Unknown
- Storage: 8/16GB
- Battery: 1,700 mAh
- USB-C, Waterproof IPX8
- Firmware config notes: Full refresh every 12 updates (better contrast), ordered dithering

#### Kindle 11 (October 2022)
- Model: C2V2L3
- Display: 6-inch Carta 1200, 300 PPI, LED frontlit
- CPU: MediaTek MT8113 2 GHz
- Storage: 16GB
- Battery: 1,040 mAh
- USB-C
- Firmware config notes: Full refresh every 10 updates, ordered dithering

#### Kindle Basic 10 (April 2019)
- Model: J9G29R  
- Display: 6-inch Pearl, 167 PPI, LED frontlit
- Storage: 4/8GB
- Battery: 1,040 mAh
- NOTE: Lower resolution, more ghosting-prone
- Firmware config notes: Full refresh every 5 updates (more frequent due to ghosting), no dithering

---

## 2. FIRMWARE vs SIMULATOR COMPARISON

### ❌ CRITICAL: Simulator Does NOT Support Kindle Devices

**Finding:** Both simulators (`public/simulator.html` and `tools/simulator/index.html`) only support TRMNL OG at 800×480.

| Feature | TRMNL Firmware | TRMNL Simulator | Kindle Firmware | Kindle Simulator |
|---------|---------------|-----------------|-----------------|------------------|
| Resolution | 800×480 | 800×480 ✅ | Various (see above) | ❌ NOT SUPPORTED |
| 20s refresh | ✅ | ❌ Missing | ✅ | ❌ NOT SUPPORTED |
| Zone refresh | ✅ | ❌ Missing | ✅ | ❌ NOT SUPPORTED |
| Anti-ghosting | ✅ | ❌ Missing | ✅ | ❌ NOT SUPPORTED |
| Boot sequence | ✅ | ❌ Missing | ✅ | ❌ NOT SUPPORTED |

**Remediation Required:**
1. Create multi-device simulator supporting all 6 devices
2. Implement 20-second zone-based refresh simulation
3. Add anti-ghosting visual effect
4. Add boot sequence simulation
5. Match refresh intervals per device config

---

## 3. SANITIZATION AUDIT

### ❌ CRITICAL: Claude/Clawdbot/Anthropic References Found

**30+ files contain references that must be removed:**

```
./FINAL-TEST-REPORT-2026-01-27.md: "Tested By: Claude Sonnet 4.5"
./END-TO-END-TEST-REPORT-2026-01-27.md: "Tester: Claude Sonnet 4.5"
./COMPLIANCE-FIXES-DEPLOYED.md: "Deployed By: Claude Sonnet 4.5"
./firmware/QR-CODE-CRASH-REPORT.md: "Report Author: Claude (Anthropic)"
./firmware/FIRMWARE-AUDIT-REPORT-2026-01-27.md: "Auditor: Claude Code"
./BRANCH-IMPLEMENTATION-SUMMARY.md: "claude/test-audit-system" branch refs
./DOCUMENTATION-INDEX.md: "Maintained By: Claude Sonnet 4.5"
./docs/archive/FIXES_COMPREHENSIVE.md: "Author: Claude Sonnet 4.5"
./docs/audits/AUDIT-001-20260128-2308.md: "Claude Opus 4.5 (Clawdbot)"
./docs/development/DEVELOPMENT-RULES.md: "Co-Authored-By: Claude"
./docs/development/VERSION-MANAGEMENT.md: "Maintained By: Claude"
./docs/CODE-CONSISTENCY-AUDIT.md: "Audit Performed By: Claude"
./docs/deployment/*.md: Multiple Claude references
```

### ❌ CRITICAL: Hardcoded Credentials Found

**File: `user-preferences.json`**
```json
"token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
"apiKey": "ce606b90-9ffb-43e8-bcd7-0c2bd0498367"
"apiKey": "AIzaSyA9WYpRfLtBiEQfvTD-ac4ImHBohHsv3yQ"
```

**Remediation Required:**
1. Remove `user-preferences.json` from repo
2. Add to `.gitignore`
3. Rotate all exposed API keys immediately
4. Create `user-preferences.example.json` with placeholders

### ✅ License: PASSED

- CC BY-NC 4.0 correctly applied
- Attribution to Angus Bergman ✅
- Commercial use restrictions clear ✅
- Third-party attribution requirements documented ✅

---

## 4. CODE AUDIT

### TRMNL Firmware (ESP32-C3)
- **File:** `firmware/src/main.cpp`
- **Version:** v5.18
- **Status:** ✅ Functional
- **Screen:** 800×480 (EP75_800x480)
- **Refresh:** 30 second interval
- **Libraries:** bb_epaper, WiFiManager, ArduinoJson, NTPClient

### Kindle Firmware
- **Location:** `firmware/kindle/*/device-config.sh`
- **Devices:** 5 configurations present
- **Status:** ✅ Configs verified against manufacturer specs

### Missing Tests
- No automated unit tests for firmware
- No integration tests for API endpoints
- No simulator behavior tests

---

## 5. DOCUMENTATION AUDIT

| Document | Status | Notes |
|----------|--------|-------|
| README.md | ✅ | Comprehensive |
| LICENSE | ✅ | CC BY-NC 4.0 |
| ATTRIBUTION.md | ✅ | Data sources listed |
| Setup guides | ✅ | Multiple options |
| API docs | ⚠️ | Needs update for Vercel |
| Firmware docs | ✅ | Anti-brick documented |

---

## 6. FINDINGS SUMMARY

### Critical (Must Fix)
| # | Issue | Severity | Remediation |
|---|-------|----------|-------------|
| 1 | Simulator missing Kindle support | CRITICAL | Build multi-device simulator |
| 2 | Claude/Clawdbot references (30+ files) | CRITICAL | Remove all references |
| 3 | Hardcoded API keys | CRITICAL | Remove & rotate keys |

### High Priority
| # | Issue | Severity | Remediation |
|---|-------|----------|-------------|
| 4 | Simulator missing 20s refresh | HIGH | Implement zone refresh |
| 5 | Simulator missing anti-ghosting | HIGH | Add visual effect |
| 6 | No automated tests | HIGH | Add test suite |

### Medium Priority
| # | Issue | Severity | Remediation |
|---|-------|----------|-------------|
| 7 | 70+ markdown files in root | MEDIUM | Consolidate to docs/ |
| 8 | API docs need Vercel update | MEDIUM | Update endpoints |

---

## 7. PHASE 5 CHECKLIST STATUS

| Item | Status |
|------|--------|
| Code consistency audit | ✅ Pass |
| Security audit | ❌ Fail (credentials exposed) |
| API endpoint testing | ⚠️ Partial |
| Firmware stability testing | ⚠️ Needs hardware |
| Documentation completeness | ✅ Pass |
| License compliance | ✅ Pass |
| Performance benchmarking | ⏳ Not started |
| Error handling coverage | ⚠️ Partial |
| Device spec verification | ✅ Pass |
| Simulator accuracy | ❌ Fail (Kindle not supported) |
| Sanitization check | ❌ Fail (Claude refs, credentials) |

---

## 8. RECOMMENDATIONS

### Immediate Actions
1. **Remove credentials from repo** - `user-preferences.json`
2. **Rotate exposed API keys** - ODATA, Google Places
3. **Create sanitization script** for Claude/Clawdbot refs

### Before Phase 6
1. Build comprehensive multi-device simulator
2. Run sanitization across all files
3. Complete hardware testing (requires Angus sign-off)

### Before Phase 7 (Public Release)
1. Fresh git history (squash or new repo)
2. Final sanitization verification
3. Security review of exposed credential impact

---

## 9. APPENDIX: Device Config Files

### kindle-pw3/device-config.sh
```sh
export PTV_TRMNL_WIDTH=1072
export PTV_TRMNL_HEIGHT=1448
export PTV_TRMNL_PPI=300
export PTV_TRMNL_FULL_REFRESH_INTERVAL=10
export PTV_TRMNL_DITHER_MODE="ordered"
```

### kindle-pw4/device-config.sh
```sh
export PTV_TRMNL_WIDTH=1072
export PTV_TRMNL_HEIGHT=1448
export PTV_TRMNL_PPI=300
export PTV_TRMNL_FULL_REFRESH_INTERVAL=10
export PTV_TRMNL_DITHER_MODE="ordered"
```

### kindle-pw5/device-config.sh
```sh
export PTV_TRMNL_WIDTH=1236
export PTV_TRMNL_HEIGHT=1648
export PTV_TRMNL_PPI=300
export PTV_TRMNL_FULL_REFRESH_INTERVAL=12
export PTV_TRMNL_DITHER_MODE="ordered"
```

### kindle-11/device-config.sh
```sh
export PTV_TRMNL_WIDTH=1072
export PTV_TRMNL_HEIGHT=1448
export PTV_TRMNL_PPI=300
export PTV_TRMNL_FULL_REFRESH_INTERVAL=10
export PTV_TRMNL_DITHER_MODE="ordered"
```

### kindle-basic-10/device-config.sh
```sh
export PTV_TRMNL_WIDTH=600
export PTV_TRMNL_HEIGHT=800
export PTV_TRMNL_PPI=167
export PTV_TRMNL_FULL_REFRESH_INTERVAL=5
export PTV_TRMNL_DITHER_MODE="none"
```

---

**Document Owner:** Angus Bergman  
**License:** CC BY-NC 4.0  
**Next Audit:** After remediation of critical issues
