<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PTV-TRMNL Firmware Simulator</title>
    <style>
        /**
         * PTV-TRMNL Firmware Simulator
         * Copyright (c) 2025 Angus Bergman
         * Licensed under CC BY-NC 4.0
         */
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0f172a;
            color: #f8fafc;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        header p {
            color: #94a3b8;
        }
        
        .main-layout {
            display: grid;
            grid-template-columns: 850px 1fr;
            gap: 30px;
        }
        
        /* E-ink Display Simulation */
        .display-container {
            background: #1e293b;
            padding: 25px;
            border-radius: 16px;
            border: 2px solid #334155;
        }
        
        .display-label {
            font-size: 14px;
            color: #64748b;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .display-label span {
            background: #334155;
            padding: 4px 12px;
            border-radius: 4px;
            font-family: monospace;
        }
        
        #eink-display {
            width: 800px;
            height: 480px;
            background: #f5f5f0;  /* E-ink paper color */
            border: 3px solid #1a1a1a;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
        }
        
        /* Text elements on display */
        .display-text {
            position: absolute;
            font-family: "Courier New", monospace;
            color: #1a1a1a;
            white-space: nowrap;
        }
        
        .font-12x16 {
            font-size: 20px;
            font-weight: bold;
        }
        
        .font-8x8 {
            font-size: 13px;
        }
        
        .inverted {
            background: #1a1a1a;
            color: #f5f5f0;
            padding: 8px 15px;
        }
        
        .rect-box {
            position: absolute;
            border: 2px solid #1a1a1a;
        }
        
        /* Control Panel */
        .controls {
            background: #1e293b;
            padding: 25px;
            border-radius: 16px;
            border: 2px solid #334155;
            max-height: 540px;
            overflow-y: auto;
        }
        
        .controls h2 {
            font-size: 18px;
            margin-bottom: 20px;
            color: #6366f1;
        }
        
        .control-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #334155;
        }
        
        .control-section:last-child {
            border-bottom: none;
        }
        
        .control-section h3 {
            font-size: 14px;
            color: #94a3b8;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .control-group {
            margin-bottom: 12px;
        }
        
        .control-group label {
            display: block;
            font-size: 12px;
            color: #64748b;
            margin-bottom: 4px;
        }
        
        .control-group input, .control-group select {
            width: 100%;
            padding: 8px 12px;
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 6px;
            color: #f8fafc;
            font-size: 14px;
        }
        
        .control-group input:focus, .control-group select:focus {
            outline: none;
            border-color: #6366f1;
        }
        
        .button-row {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        button {
            flex: 1;
            padding: 12px;
            background: #6366f1;
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        button:hover {
            background: #4f46e5;
        }
        
        button.secondary {
            background: #334155;
        }
        
        button.secondary:hover {
            background: #475569;
        }
        
        /* Status Bar */
        .status-bar {
            margin-top: 20px;
            background: #1e293b;
            padding: 15px 25px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
        }
        
        .status-bar .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #22c55e;
        }
        
        .status-dot.warning { background: #f59e0b; }
        .status-dot.error { background: #ef4444; }
        
        /* Presets */
        .presets {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .preset-btn {
            padding: 8px;
            font-size: 12px;
            background: #334155;
        }
        
        /* Footer */
        footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #334155;
            color: #64748b;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìü PTV-TRMNL Firmware Simulator</h1>
            <p>Live testing of e-ink display output ‚Ä¢ 800√ó480 TRMNL BYOS</p>
        </header>
        
        <div class="main-layout">
            <!-- E-ink Display -->
            <div class="display-container">
                <div class="display-label">
                    <span>EP75_800x480</span>
                    <span id="refresh-mode">REFRESH_FULL</span>
                </div>
                <div id="eink-display">
                    <!-- Display content rendered by JavaScript -->
                </div>
            </div>
            
            <!-- Control Panel -->
            <div class="controls">
                <h2>‚öôÔ∏è Display Controls</h2>
                
                <div class="presets">
                    <button class="preset-btn" onclick="loadPreset('morning')">Morning Commute</button>
                    <button class="preset-btn" onclick="loadPreset('coffee')">Coffee Stop</button>
                    <button class="preset-btn" onclick="loadPreset('direct')">Go Direct</button>
                    <button class="preset-btn" onclick="loadPreset('setup')">Setup Mode</button>
                </div>
                
                <div class="control-section">
                    <h3>üìç Header</h3>
                    <div class="control-group">
                        <label>Location</label>
                        <input type="text" id="input-location" value="South Yarra, VIC" oninput="updateDisplay()">
                    </div>
                    <div class="control-group">
                        <label>Current Time</label>
                        <input type="text" id="input-time" value="08:15" oninput="updateDisplay()">
                    </div>
                </div>
                
                <div class="control-section">
                    <h3>‚òï Coffee Decision</h3>
                    <div class="control-group">
                        <label>Show Coffee Banner</label>
                        <select id="input-coffee" onchange="updateDisplay()">
                            <option value="yes">YES - Stop for Coffee</option>
                            <option value="no">NO - Go Direct</option>
                            <option value="none">Hidden</option>
                        </select>
                    </div>
                </div>
                
                <div class="control-section">
                    <h3>üöä Leg 1 - Tram</h3>
                    <div class="control-group">
                        <label>Stop Name</label>
                        <input type="text" id="input-tram-stop" value="Chapel St/Tivoli Rd" oninput="updateDisplay()">
                    </div>
                    <div class="control-group">
                        <label>Departures (comma separated)</label>
                        <input type="text" id="input-tram-deps" value="3,8,15" oninput="updateDisplay()">
                    </div>
                </div>
                
                <div class="control-section">
                    <h3>üöÜ Leg 2 - Train</h3>
                    <div class="control-group">
                        <label>Stop Name</label>
                        <input type="text" id="input-train-stop" value="South Yarra Station" oninput="updateDisplay()">
                    </div>
                    <div class="control-group">
                        <label>Destination</label>
                        <input type="text" id="input-train-dest" value="Parliament" oninput="updateDisplay()">
                    </div>
                    <div class="control-group">
                        <label>Departures (comma separated)</label>
                        <input type="text" id="input-train-deps" value="5,12,19" oninput="updateDisplay()">
                    </div>
                </div>
                
                <div class="control-section">
                    <h3>‚è∞ Journey Box</h3>
                    <div class="control-group">
                        <label>Leave By</label>
                        <input type="text" id="input-leave" value="08:18" oninput="updateDisplay()">
                    </div>
                    <div class="control-group">
                        <label>Arrive At</label>
                        <input type="text" id="input-arrive" value="08:52" oninput="updateDisplay()">
                    </div>
                </div>
                
                <div class="control-section">
                    <h3>üå§Ô∏è Footer</h3>
                    <div class="control-group">
                        <label>Weather</label>
                        <input type="text" id="input-weather" value="18¬∞C Sunny" oninput="updateDisplay()">
                    </div>
                    <div class="control-group">
                        <label>Refresh Count</label>
                        <input type="number" id="input-refresh" value="42" oninput="updateDisplay()">
                    </div>
                </div>
                
                <div class="button-row">
                    <button onclick="simulateRefresh()">Simulate Refresh</button>
                    <button class="secondary" onclick="exportConfig()">Export Config</button>
                </div>
            </div>
        </div>
        
        <div class="status-bar">
            <div class="status-item">
                <div class="status-dot"></div>
                <span>Simulator Active</span>
            </div>
            <div class="status-item">
                <span>Firmware: v5.18</span>
            </div>
            <div class="status-item">
                <span>Display: 800√ó480</span>
            </div>
            <div class="status-item">
                <span id="last-update">Last update: --</span>
            </div>
        </div>
        
        <footer>
            PTV-TRMNL Firmware Simulator ‚Ä¢ ¬© 2025 Angus Bergman ‚Ä¢ CC BY-NC 4.0
        </footer>
    </div>
    
    <script>
        // Display configuration
        const display = {
            width: 800,
            height: 480,
            bgColor: '#f5f5f0',
            fgColor: '#1a1a1a'
        };
        
        // Font sizes (approximating firmware fonts)
        const fonts = {
            'FONT_12x16': { size: 20, weight: 'bold' },
            'FONT_8x8': { size: 13, weight: 'normal' }
        };
        
        // Update display based on inputs
        function updateDisplay() {
            const displayEl = document.getElementById('eink-display');
            displayEl.innerHTML = '';
            
            const config = getConfig();
            
            // Header
            addText(20, 25, `PTV-TRMNL ‚Ä¢ ${config.location}`, 'FONT_12x16');
            addText(680, 25, config.time, 'FONT_12x16');
            
            // Horizontal line
            addLine(0, 50, 800, 50);
            
            // Coffee banner
            const bannerY = 60;
            if (config.coffee === 'yes') {
                addRect(0, bannerY, 800, 35, true);
                addText(250, bannerY + 10, '>>> STOP FOR COFFEE <<<', 'FONT_12x16', true);
            } else if (config.coffee === 'no') {
                addText(280, bannerY + 10, '>>> GO DIRECT <<<', 'FONT_12x16');
            }
            
            // Leg 1 - Tram
            const leg1Y = 110;
            addText(20, leg1Y, 'üöä LEG 1: TRAM', 'FONT_12x16');
            addText(30, leg1Y + 30, config.tramStop, 'FONT_8x8');
            
            config.tramDeps.forEach((dep, i) => {
                const minText = dep === 1 ? 'min' : 'mins';
                addText(40, leg1Y + 55 + (i * 25), `${dep} ${minText}`, 'FONT_8x8');
            });
            
            // Transfer indicator
            const transferY = 220;
            addText(350, transferY, '| transfer |', 'FONT_8x8');
            
            // Leg 2 - Train
            const leg2Y = 250;
            addText(20, leg2Y, 'üöÜ LEG 2: TRAIN', 'FONT_12x16');
            addText(30, leg2Y + 30, `${config.trainStop} ‚Üí ${config.trainDest}`, 'FONT_8x8');
            
            config.trainDeps.forEach((dep, i) => {
                const minText = dep === 1 ? 'min' : 'mins';
                addText(40, leg2Y + 55 + (i * 25), `${dep} ${minText}`, 'FONT_8x8');
            });
            
            // Journey box
            const boxX = 500;
            const boxY = 110;
            addRect(boxX, boxY, 280, 140);
            addText(boxX + 60, boxY + 20, 'LEAVE BY', 'FONT_12x16');
            addText(boxX + 80, boxY + 55, config.leaveBy, 'FONT_12x16');
            addText(boxX + 70, boxY + 90, 'Arrive at work:', 'FONT_8x8');
            addText(boxX + 90, boxY + 110, config.arriveBy, 'FONT_12x16');
            
            // Footer
            addLine(0, 430, 800, 430);
            addText(20, 450, `Weather: ${config.weather}`, 'FONT_8x8');
            addText(350, 450, `Refresh #${config.refreshCount}`, 'FONT_8x8');
            addText(650, 450, 'v5.18', 'FONT_8x8');
            
            // Update timestamp
            document.getElementById('last-update').textContent = 
                `Last update: ${new Date().toLocaleTimeString()}`;
        }
        
        function addText(x, y, text, font, inverted = false) {
            const displayEl = document.getElementById('eink-display');
            const el = document.createElement('div');
            el.className = `display-text ${font === 'FONT_12x16' ? 'font-12x16' : 'font-8x8'}${inverted ? ' inverted' : ''}`;
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            el.textContent = text;
            displayEl.appendChild(el);
        }
        
        function addRect(x, y, w, h, filled = false) {
            const displayEl = document.getElementById('eink-display');
            const el = document.createElement('div');
            el.className = 'rect-box';
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            el.style.width = w + 'px';
            el.style.height = h + 'px';
            if (filled) {
                el.style.background = '#1a1a1a';
                el.style.border = 'none';
            }
            displayEl.appendChild(el);
        }
        
        function addLine(x1, y1, x2, y2) {
            const displayEl = document.getElementById('eink-display');
            const el = document.createElement('div');
            el.style.position = 'absolute';
            el.style.left = x1 + 'px';
            el.style.top = y1 + 'px';
            el.style.width = (x2 - x1) + 'px';
            el.style.height = '1px';
            el.style.background = '#1a1a1a';
            displayEl.appendChild(el);
        }
        
        function getConfig() {
            return {
                location: document.getElementById('input-location').value,
                time: document.getElementById('input-time').value,
                coffee: document.getElementById('input-coffee').value,
                tramStop: document.getElementById('input-tram-stop').value,
                tramDeps: document.getElementById('input-tram-deps').value.split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n)),
                trainStop: document.getElementById('input-train-stop').value,
                trainDest: document.getElementById('input-train-dest').value,
                trainDeps: document.getElementById('input-train-deps').value.split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n)),
                leaveBy: document.getElementById('input-leave').value,
                arriveBy: document.getElementById('input-arrive').value,
                weather: document.getElementById('input-weather').value,
                refreshCount: document.getElementById('input-refresh').value
            };
        }
        
        function loadPreset(preset) {
            const presets = {
                morning: {
                    location: 'South Yarra, VIC',
                    time: '07:45',
                    coffee: 'yes',
                    tramStop: 'Chapel St/Tivoli Rd',
                    tramDeps: '3,8,15',
                    trainStop: 'South Yarra Station',
                    trainDest: 'Parliament',
                    trainDeps: '5,12,19',
                    leaveBy: '07:52',
                    arriveBy: '08:28',
                    weather: '16¬∞C Partly Cloudy'
                },
                coffee: {
                    location: 'South Yarra, VIC',
                    time: '08:15',
                    coffee: 'yes',
                    tramStop: 'Chapel St/Tivoli Rd',
                    tramDeps: '2,9,16',
                    trainStop: 'South Yarra Station',
                    trainDest: 'Parliament',
                    trainDeps: '8,15,22',
                    leaveBy: '08:18',
                    arriveBy: '08:52',
                    weather: '18¬∞C Sunny'
                },
                direct: {
                    location: 'South Yarra, VIC',
                    time: '08:35',
                    coffee: 'no',
                    tramStop: 'Chapel St/Tivoli Rd',
                    tramDeps: '1,6,13',
                    trainStop: 'South Yarra Station',
                    trainDest: 'Parliament',
                    trainDeps: '4,11,18',
                    leaveBy: '08:37',
                    arriveBy: '08:58',
                    weather: '20¬∞C Clear'
                },
                setup: {
                    location: 'Setup Mode',
                    time: '--:--',
                    coffee: 'none',
                    tramStop: 'Waiting for config...',
                    tramDeps: '',
                    trainStop: 'Not configured',
                    trainDest: '---',
                    trainDeps: '',
                    leaveBy: '--:--',
                    arriveBy: '--:--',
                    weather: 'Connecting...'
                }
            };
            
            const p = presets[preset];
            document.getElementById('input-location').value = p.location;
            document.getElementById('input-time').value = p.time;
            document.getElementById('input-coffee').value = p.coffee;
            document.getElementById('input-tram-stop').value = p.tramStop;
            document.getElementById('input-tram-deps').value = p.tramDeps;
            document.getElementById('input-train-stop').value = p.trainStop;
            document.getElementById('input-train-dest').value = p.trainDest;
            document.getElementById('input-train-deps').value = p.trainDeps;
            document.getElementById('input-leave').value = p.leaveBy;
            document.getElementById('input-arrive').value = p.arriveBy;
            document.getElementById('input-weather').value = p.weather;
            
            updateDisplay();
        }
        
        function simulateRefresh() {
            const displayEl = document.getElementById('eink-display');
            const modeEl = document.getElementById('refresh-mode');
            
            // Simulate e-ink flash
            displayEl.style.background = '#1a1a1a';
            modeEl.textContent = 'REFRESHING...';
            
            setTimeout(() => {
                displayEl.style.background = '#f5f5f0';
                modeEl.textContent = 'REFRESH_FULL';
                
                // Increment refresh count
                const countEl = document.getElementById('input-refresh');
                countEl.value = parseInt(countEl.value) + 1;
                updateDisplay();
            }, 500);
        }
        
        function exportConfig() {
            const config = getConfig();
            const json = JSON.stringify(config, null, 2);
            
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'trmnl-simulator-config.json';
            a.click();
        }
        
        // Initial render
        updateDisplay();
        
        // Live clock option
        setInterval(() => {
            const timeInput = document.getElementById('input-time');
            if (timeInput.value === 'LIVE') {
                const now = new Date();
                timeInput.value = now.toLocaleTimeString('en-AU', { hour: '2-digit', minute: '2-digit', hour12: false });
                updateDisplay();
            }
        }, 1000);
    </script>
</body>
</html>
